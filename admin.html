<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="card" style="max-width:1000px;margin:20px auto;">
    <h2>Admin Dashboard</h2>
    <div id="admin-area">
      <h3>Pending Accounts</h3>
      <div id="admin-account-requests"></div>

      <h3>Pending Posts</h3>
      <div id="admin-post-requests"></div>
    </div>
    <p><a href="index.html">Back to main</a></p>
  </div>

 <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script src="firebase-config.js"></script>
</head>
<body>

<h2>Admin Dashboard</h2>
<button onclick="logout()">Logout</button>

<h3>Pending Account Requests</h3>
<div id="requests"></div>

<script>
// Load account requests
db.collection("account_requests")
  .where("status", "==", "pending")
  .onSnapshot(snapshot => {
    let output = "";
    snapshot.forEach(doc => {
      const req = doc.data();

      output += `
        <div style="border:1px solid #ccc; padding:10px; margin:10px;">
          <b>${req.name}</b><br>
          ${req.email}<br>
          ${req.location}<br>
          ${req.contact}<br><br>
          <button onclick="approve('${doc.id}', '${req.email}', '${req.password}', '${req.name}')">
            Approve
          </button>
          <button onclick="decline('${doc.id}')">Decline</button>
        </div>
      `;
    });

    document.getElementById("requests").innerHTML = output;
  });

// Approve user
function approve(id, email, pass, name) {
  auth.createUserWithEmailAndPassword(email, pass)
  .then(user => {
    const uid = user.user.uid;

    // Add to users collection
    db.collection("users").doc(uid).set({
      name: name,
      email: email,
      role: "user",
      status: "approved"
    });

    // Update request status
    db.collection("account_requests").doc(id).update({
      status: "approved"
    });
  });
}

function decline(id) {
  db.collection("account_requests").doc(id).delete();
}

function logout() {
  auth.signOut().then(() => {
    window.location.href = "index.html";
  });
}
</script>
</body>
</html>
